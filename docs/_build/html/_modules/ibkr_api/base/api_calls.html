
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ibkr_api.base.api_calls &#8212; ibkr-api  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ibkr_api.base.api_calls</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>


<span class="kn">from</span> <span class="nn">ibkr_api.base.bridge_connection</span> <span class="k">import</span> <span class="n">BridgeConnection</span>
<span class="kn">from</span> <span class="nn">ibkr_api.base.constants</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ibkr_api.base.errors</span> <span class="k">import</span> <span class="n">NOT_CONNECTED</span><span class="p">,</span> <span class="n">UPDATE_TWS</span><span class="p">,</span> <span class="n">Errors</span><span class="p">,</span> <span class="n">BAD_MESSAGE</span>
<span class="kn">from</span> <span class="nn">ibkr_api.base.messages</span> <span class="k">import</span> <span class="n">Messages</span>
<span class="kn">from</span> <span class="nn">ibkr_api.base.message_parser</span> <span class="k">import</span> <span class="n">MessageParser</span>

<span class="kn">from</span> <span class="nn">ibkr_api.classes.contracts.contract</span> <span class="k">import</span> <span class="n">Contract</span>
<span class="kn">from</span> <span class="nn">ibkr_api.classes.order</span> <span class="k">import</span> <span class="n">Order</span>
<span class="kn">from</span> <span class="nn">ibkr_api.classes.scanner</span> <span class="k">import</span> <span class="n">Scanner</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="check_connection"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.check_connection">[docs]</a><span class="k">def</span> <span class="nf">check_connection</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">new_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">func_args</span><span class="p">,</span><span class="o">**</span><span class="n">func_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="c1">#self.response_handler.error(NO_VALID_ID, NOT_CONNECTED.code(), NOT_CONNECTED.msg())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not connected to the Bridge Application (TWS/IB Gateway).&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">func_args</span><span class="p">,</span> <span class="o">**</span><span class="n">func_kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_func</span></div>

<div class="viewcode-block" id="ApiCalls"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls">[docs]</a><span class="k">class</span> <span class="nc">ApiCalls</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encapsulates all the requests that are available via the API</span>

<span class="sd">    ## Responsibilities</span>
<span class="sd">    Call the underlying API call</span>
<span class="sd">    Call any user defined request_handler function as needed</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response_handler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request_handler</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_state</span>              <span class="o">=</span> <span class="s2">&quot;Detached from Bridge&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span>              <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span>                   <span class="o">=</span> <span class="kc">None</span>                 <span class="c1"># Connection between this application and the bridge</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">host</span>                   <span class="o">=</span> <span class="kc">None</span>                 <span class="c1"># Bridge&#39;s Host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optional_capabilities</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span>                   <span class="c1"># Hell if I know, IBKR&#39;s documentation has nothing...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span>                   <span class="o">=</span> <span class="kc">None</span>                 <span class="c1"># Bridge&#39;s Port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span>             <span class="o">=</span> <span class="mi">0</span>                    <span class="c1"># Unique Identifier for the request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_version_</span>        <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">connection_time</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_parser</span>   <span class="o">=</span> <span class="n">MessageParser</span><span class="p">()</span>   <span class="c1"># Converts from message data to object(s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_handler</span>  <span class="o">=</span> <span class="n">request_handler</span>   <span class="c1"># Functions if exist are called before and/or after api calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span> <span class="o">=</span> <span class="n">response_handler</span>  <span class="c1"># API Responses Functions provided by the end user</span>

    <span class="k">def</span> <span class="nf">_send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the message if connected.</span>
<span class="sd">        If not connected, and a response handler is defined, send an error back</span>
<span class="sd">        otherwise just raise an error</span>

<span class="sd">        :param fields: The message&#39;s fields</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">NO_VALID_ID</span><span class="p">,</span> <span class="n">NOT_CONNECTED</span><span class="o">.</span><span class="n">code</span><span class="p">(),</span> <span class="n">NOT_CONNECTED</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">Errors</span><span class="o">.</span><span class="n">connect_fail</span><span class="p">()[</span><span class="s1">&#39;message&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

    <span class="c1">####################</span>
    <span class="c1"># Public Functions #</span>
    <span class="c1">####################</span>
<div class="viewcode-block" id="ApiCalls.get_local_request_id"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.get_local_request_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_local_request_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">request_id</span></div>

<div class="viewcode-block" id="ApiCalls.calculate_implied_volatility"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.calculate_implied_volatility">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">calculate_implied_volatility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span>
                                     <span class="n">option_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">underlying_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                                     <span class="n">implVolOptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function to calculate volatility for a supplied</span>
<span class="sd">        option price and underlying price. Result will be delivered</span>
<span class="sd">        via EWrapper.tickOptionComputation()</span>

<span class="sd">        request_id:int -  The request id.</span>
<span class="sd">        contract:Contract -  Describes the contract.</span>
<span class="sd">        option_price:double - The price of the option.</span>
<span class="sd">        underlying_price:double - Price of the underlying.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># send req market data msg</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_calc_implied_volat&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span> <span class="n">option_price</span><span class="p">,</span> <span class="n">underlying_price</span><span class="p">]</span>

        <span class="n">implVolOptStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">tag_values_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">implVolOptions</span><span class="p">)</span> <span class="k">if</span> <span class="n">implVolOptions</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">implVolOptions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">implVolOpt</span> <span class="ow">in</span> <span class="n">implVolOptions</span><span class="p">:</span>
                <span class="n">implVolOptStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">implVolOpt</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">tag_values_count</span><span class="p">,</span> <span class="n">implVolOptStr</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.calculate_option_price"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.calculate_option_price">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">calculate_option_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span>
                               <span class="n">volatility</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">underlying_price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                               <span class="n">optPrcOptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to calculate option price and greek values</span>
<span class="sd">        for a supplied volatility and underlying price.</span>

<span class="sd">        request_id:int -    The ticker ID.</span>
<span class="sd">        contract:Contract - Describes the contract.</span>
<span class="sd">        volatility:double - The volatility.</span>
<span class="sd">        underlying_price:double - Price of the underlying.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c1"># send req market data msg</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_calc_option_price&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">]</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span> <span class="n">volatility</span><span class="p">,</span> <span class="n">underlying_price</span><span class="p">])</span>


        <span class="n">option_price_options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">tag_values_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">optPrcOptions</span><span class="p">)</span> <span class="k">if</span> <span class="n">optPrcOptions</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">optPrcOptions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">implVolOpt</span> <span class="ow">in</span> <span class="n">optPrcOptions</span><span class="p">:</span>
                <span class="n">option_price_options</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">implVolOpt</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">tag_values_count</span><span class="p">,</span> <span class="n">optPrcOptions</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_account_summary"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_account_summary">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_account_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cancels the request for Account Window Summary tab data.</span>

<span class="sd">        request_id:int - The ID of the data request being canceled.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_account_summary&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_account_updates_multi"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_account_updates_multi">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_account_updates_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_account_updates_multi&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.cancel_calculate_implied_volatility"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_calculate_implied_volatility">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_calculate_implied_volatility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to cancel a request to calculate</span>
<span class="sd">        volatility for a supplied option price and underlying price.</span>

<span class="sd">        request_id:int - The request ID.  &quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_calculate_implied_volatility&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_calculate_option_price"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_calculate_option_price">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_calculate_option_price</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to cancel a request to calculate the option</span>
<span class="sd">        price and greek values for a supplied volatility and underlying price.</span>

<span class="sd">        request_id:int - The request ID.  &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_calc_option_price&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>



<div class="viewcode-block" id="ApiCalls.cancel_fundamental_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_fundamental_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_fundamental_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call this function to stop receiving fundamental data.</span>

<span class="sd">        request_id:int - The ID of the data request.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_fundamental_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.cancel_market_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_market_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_market_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After calling this function, market data for the specified id</span>
<span class="sd">        will stop flowing.</span>

<span class="sd">        request_id: int - The ID that was specified in the call to</span>
<span class="sd">            reqMktData(). &quot;&quot;&quot;</span>
        <span class="c1"># send req market data msg</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_market_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_market_depth"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_market_depth">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_market_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">is_smart_depth</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After calling this function, market depth data for the specified id</span>
<span class="sd">        will stop flowing.</span>

<span class="sd">        request_id:int - The ID that was specified in the call to</span>
<span class="sd">            reqMktDepth().</span>
<span class="sd">        is_smart_depth:bool - specifies SMART depth request&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># send cancel market depth msg</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_market_depth&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_SMART_DEPTH</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">is_smart_depth</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_order"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_order">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to cancel an order.</span>

<span class="sd">        order_id:int - The order ID that was specified previously in the call</span>
<span class="sd">            to placeOrder()&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_order&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">order_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_positions"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_positions">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cancels real-time position updates.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_positions&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_positions_multi"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_positions_multi">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_positions_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_positions_multi&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_pnl"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_pnl">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_pnl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param request_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_pnl&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_pnl_single"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_pnl_single">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_pnl_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_pnl_single&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_real_time_bars"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_real_time_bars">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_real_time_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the cancel_real_time_bars() function to stop receiving real time bar results.</span>

<span class="sd">        request_id:int - The Id that was specified in the call to reqRealTimeBars(). &quot;&quot;&quot;</span>

        <span class="c1"># send req market data msg</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_real_time_bars&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_scanner_subscription"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_scanner_subscription">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_scanner_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;request_id:int - The ticker ID. Must be a unique value.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_scanner_subscription&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.cancel_tick_by_tick_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_tick_by_tick_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_tick_by_tick_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_tick_by_tick_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.exercise_options"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.exercise_options">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">exercise_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span>
                         <span class="n">exercize_action</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">exercize_quantity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                         <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">override</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;request_id:int - The ticker id. multipleust be a unique value.</span>
<span class="sd">        contract:Contract - This structure contains a description of the</span>
<span class="sd">            contract to be exercised</span>
<span class="sd">        exercize_action:int - Specifies whether you want the option to lapse</span>
<span class="sd">            or be exercised.</span>
<span class="sd">            Values are 1 = exercise, 2 = lapse.</span>
<span class="sd">        exercize_quantity:int - The quantity you want to exercise.</span>
<span class="sd">        account:str - destination account</span>
<span class="sd">        override:int - Specifies whether your setting will override the system&#39;s</span>
<span class="sd">            natural action. For example, if your action is &quot;exercise&quot; and the</span>
<span class="sd">            option is not in-the-money, by natural action the option would not</span>
<span class="sd">            exercise. If you have override set to &quot;yes&quot; the natural action would</span>
<span class="sd">             be overridden and the out-of-the money option would be exercised.</span>
<span class="sd">            Values are: 0 = no, 1 = yes.&quot;&quot;&quot;</span>

        <span class="n">insert_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;exercise_options&#39;</span><span class="p">]</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span> <span class="n">exercize_action</span><span class="p">,</span> <span class="n">exercize_quantity</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">override</span><span class="p">]</span>

        <span class="c1"># send contract fields</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_TRADING_CLASS</span><span class="p">:</span>
            <span class="n">insert_offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_TRADING_CLASS</span><span class="p">:</span>
            <span class="n">insert_position</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">insert_offset</span>
            <span class="n">insert_offset</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_position</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.place_order"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.place_order">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">place_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to place an order. The order status will</span>
<span class="sd">        be returned by the orderStatus event.</span>

<span class="sd">        order_id:int - The order id. You must specify a unique value. When the</span>
<span class="sd">            order START_APItus returns, it will be identified by this tag.</span>
<span class="sd">            This tag is also used when canceling the order.</span>
<span class="sd">        contract:Contract - This structure contains a description of the</span>
<span class="sd">            contract which is being traded.</span>
<span class="sd">        order:Order - This structure contains the details of tradedhe order.</span>
<span class="sd">            Note: Each client MUST connect with a unique client_id.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">MIN_SERVER_VER_DELTA_NEUTRAL_CONID</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_con_id</span> <span class="o">&gt;</span> <span class="mi">0</span> \
                    <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_settling_firm</span> \
                    <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_clearing_account</span> \
                    <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">deltaNeutralClearingIntent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">UPDATE_TWS</span><span class="o">.</span><span class="n">code</span><span class="p">(),</span> <span class="n">UPDATE_TWS</span><span class="o">.</span><span class="n">msg</span><span class="p">()</span> <span class="o">+</span>
                                            <span class="s2">&quot;  It does not support deltaNeutral parameters: ConId, SettlingFirm, ClearingAccount, ClearingIntent.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">MIN_SERVER_VER_SCALE_ORDERS3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">scalePriceIncrement</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">order</span><span class="o">.</span><span class="n">scalePriceIncrement</span> <span class="o">!=</span> <span class="n">UNSET_DOUBLE</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">scalePriceAdjustValue</span> <span class="o">!=</span> <span class="n">UNSET_DOUBLE</span> \
                        <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">scalePriceAdjustInterval</span> <span class="o">!=</span> <span class="n">UNSET_INTEGER</span> \
                        <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">scaleProfitOffset</span> <span class="o">!=</span> <span class="n">UNSET_DOUBLE</span> \
                        <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">scaleAutoReset</span> \
                        <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">scaleInitPosition</span> <span class="o">!=</span> <span class="n">UNSET_INTEGER</span> \
                        <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">scaleInitFillQty</span> <span class="o">!=</span> <span class="n">UNSET_INTEGER</span> \
                        <span class="ow">or</span> <span class="n">order</span><span class="o">.</span><span class="n">scaleRandomPercent</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">order_id</span><span class="p">,</span> <span class="n">UPDATE_TWS</span><span class="o">.</span><span class="n">code</span><span class="p">(),</span> <span class="n">UPDATE_TWS</span><span class="o">.</span><span class="n">msg</span><span class="p">()</span> <span class="o">+</span>
                                                <span class="s2">&quot;  It does not support Scale order parameters: PriceAdjustValue, PriceAdjustInterval, &quot;</span> <span class="o">+</span>
                                                <span class="s2">&quot;ProfitOffset, AutoReset, InitPosition, InitFillQty and RandomPercent&quot;</span><span class="p">)</span>
                    <span class="k">return</span>






        <span class="c1"># Create the list of fields to send, then send the message</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;place_order&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">MIN_SERVER_VER_ORDER_CONTAINER</span><span class="p">:</span>
            <span class="n">message_version</span> <span class="o">=</span> <span class="mi">27</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">MIN_SERVER_VER_NOT_HELD</span><span class="p">)</span> <span class="k">else</span> <span class="mi">45</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message_version</span><span class="p">)</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>

        <span class="c1"># send contract fields</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_PLACE_ORDER_CONID</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                   <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">]</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">contract</span><span class="o">.</span><span class="n">security_id_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_id</span><span class="p">]</span>
        <span class="c1"># send main order fields</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">total_quantity</span><span class="p">)</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_field_handle_empty</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">limit_price</span><span class="p">))</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_field_handle_empty</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">aux_price</span><span class="p">))</span>

        <span class="c1"># send extended order fields</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">tif</span>            <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">ocaGroup</span>       <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">account</span>        <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">openClose</span>      <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">origin</span>         <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">order_ref</span>      <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">transmit</span>       <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">parent_id</span>      <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">block_order</span>    <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">sweep_to_fill</span>  <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">display_size</span>   <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">trigger_method</span> <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">outside_rth</span>    <span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">hidden</span><span class="p">]</span>

        <span class="c1"># Send combo legs for BAG requests (srv v8 and above)</span>
        <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span> <span class="o">==</span> <span class="s2">&quot;BAG&quot;</span><span class="p">:</span>
            <span class="n">comboLegsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span><span class="p">)</span> <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLegsCount</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comboLegsCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">comboLeg</span> <span class="ow">in</span> <span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">comboLeg</span>
                    <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">conId</span><span class="p">,</span>
                               <span class="n">comboLeg</span><span class="o">.</span><span class="n">ratio</span><span class="p">,</span>
                               <span class="n">comboLeg</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                               <span class="n">comboLeg</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                               <span class="n">comboLeg</span><span class="o">.</span><span class="n">openClose</span><span class="p">,</span>
                               <span class="n">comboLeg</span><span class="o">.</span><span class="n">shortSaleSlot</span><span class="p">,</span>  <span class="c1"># srv v35 and above</span>
                               <span class="n">comboLeg</span><span class="o">.</span><span class="n">designatedLocation</span><span class="p">]</span>  <span class="c1"># srv v35 and above</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_SSHORTX_OLD</span><span class="p">:</span>
                        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">exemptCode</span><span class="p">)</span>

        <span class="c1"># Send order combo legs for BAG requests</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_ORDER_COMBO_LEGS_PRICE</span> <span class="ow">and</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span> <span class="o">==</span> <span class="s2">&quot;BAG&quot;</span><span class="p">:</span>
            <span class="n">orderComboLegsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">orderComboLegs</span><span class="p">)</span> <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderComboLegs</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderComboLegsCount</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">orderComboLegsCount</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">orderComboLeg</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">orderComboLegs</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="n">orderComboLeg</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orderComboLeg</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_SMART_COMBO_ROUTING_PARAMS</span> <span class="ow">and</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span> <span class="o">==</span> <span class="s2">&quot;BAG&quot;</span><span class="p">:</span>
            <span class="n">smartComboRoutingParamsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">smartComboRoutingParams</span><span class="p">)</span> <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">smartComboRoutingParams</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">smartComboRoutingParamsCount</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">smartComboRoutingParamsCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tagValue</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">smartComboRoutingParams</span><span class="p">:</span>
                    <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tagValue</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">tagValue</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="c1">######################################################################</span>
        <span class="c1"># Send the shares allocation.</span>
        <span class="c1">#</span>
        <span class="c1"># This specifies the number of order shares allocated to each Financial</span>
        <span class="c1"># Advisor managed account. The format of the allocation string is as</span>
        <span class="c1"># follows:</span>
        <span class="c1">#                      &lt;account_code1&gt;/&lt;number_shares1&gt;,&lt;account_code2&gt;/&lt;number_shares2&gt;,...N</span>
        <span class="c1"># E.g.</span>
        <span class="c1">#              To allocate 20 shares of a 100 share order to account &#39;U101&#39; and the</span>
        <span class="c1">#      residual 80 to account &#39;U203&#39; enter the following share allocation string:</span>
        <span class="c1">#          U101/20,U203/80</span>
        <span class="c1">#####################################################################</span>
        <span class="c1"># send deprecated sharesAllocation field</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">discretionaryAmt</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">good_after_time</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">good_till_date</span><span class="p">,</span>

                   <span class="n">order</span><span class="o">.</span><span class="n">financial_advisers_group</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">financial_advisers_method</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">financial_advisers_percentage</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">financial_advisers_profile</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">modelCode</span>
                   <span class="p">]</span>


        <span class="c1"># institutional Short Sale Slot Data</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">order</span><span class="o">.</span><span class="n">shortSaleSlot</span><span class="p">,</span>         <span class="c1"># 0 for retail, 1 or 2 for institutions</span>
                    <span class="n">order</span><span class="o">.</span><span class="n">designatedLocation</span><span class="p">,</span>    <span class="c1"># populate only when shortSaleSlot = 2.</span>
                    <span class="n">order</span><span class="o">.</span><span class="n">exemptCode</span><span class="p">]</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">oca_type</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">rule80A</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">settlingFirm</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">allOrNone</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">min_qty</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">percent_offset</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">eTradeOnly</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">firmQuoteOnly</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">nbboPriceCap</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">auctionStrategy</span><span class="p">,</span>
                   <span class="c1"># AUCTION_MATCH, AUCTION_IMPROVEMENT, AUCTION_TRANSPARENT</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">startingPrice</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">stockRefPrice</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">stockRangeLower</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">stockRangeUpper</span><span class="p">,</span>

                   <span class="n">order</span><span class="o">.</span><span class="n">override_percentage_constraints</span><span class="p">,</span>

                   <span class="c1"># Volatility orders</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">volatility</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">volatility_type</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_order_type</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_aux_price</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_order_type</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_con_id</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_settling_firm</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_clearing_account</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">deltaNeutralClearingIntent</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">delta_neutral_order_type</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">deltaNeutralOpenClose</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">deltaNeutralShortSale</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">deltaNeutralShortSaleSlot</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">deltaNeutralDesignatedLocation</span><span class="p">]</span>

        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">continuousUpdate</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">referencePriceType</span><span class="p">,</span>
                   <span class="n">order</span><span class="o">.</span><span class="n">trail_stop_price</span><span class="p">]</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">trailing_percent</span><span class="p">)</span>

        <span class="c1"># SCALE orders</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">scaleInitLevelSize</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">scaleSubsLevelSize</span><span class="p">]</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">scalePriceIncrement</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_SCALE_ORDERS3</span> \
                <span class="ow">and</span> <span class="n">order</span><span class="o">.</span><span class="n">scalePriceIncrement</span> <span class="o">!=</span> <span class="n">UNSET_DOUBLE</span> \
                <span class="ow">and</span> <span class="n">order</span><span class="o">.</span><span class="n">scalePriceIncrement</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">scalePriceAdjustValue</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">scalePriceAdjustInterval</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">scaleProfitOffset</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">scaleAutoReset</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">scaleInitPosition</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">scaleInitFillQty</span><span class="p">,</span>
                       <span class="n">order</span><span class="o">.</span><span class="n">scaleRandomPercent</span><span class="p">]</span>


        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">scaleTable</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">active_start_time</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">active_stop_time</span><span class="p">]</span>

        <span class="c1"># HEDGE orders</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_HEDGE_ORDERS</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">hedgeType</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">hedgeType</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">hedgeParam</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_OPT_OUT_SMART_ROUTING</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">optOutSmartRouting</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_PTA_ORDERS</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">clearingAccount</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">clearingIntent</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_NOT_HELD</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">notHeld</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_DELTA_NEUTRAL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="p">:</span>
                <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="o">.</span><span class="n">conId</span><span class="p">,</span>
                           <span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span>
                           <span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="o">.</span><span class="n">price</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">algorithmic_strategy</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">algorithmic_strategy</span><span class="p">:</span>
            <span class="n">algoParamsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">algo_params</span><span class="p">)</span> <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">algo_params</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">algoParamsCount</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">algoParamsCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">algoParam</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">algo_params</span><span class="p">:</span>
                    <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">algoParam</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">algoParam</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">algoId</span><span class="p">)</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">whatIf</span><span class="p">)</span>

        <span class="c1"># send miscOptions parameter</span>

        <span class="n">miscOptionsStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">orderMiscOptions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tagValue</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">orderMiscOptions</span><span class="p">:</span>
                <span class="n">miscOptionsStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValue</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">miscOptionsStr</span><span class="p">)</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">solicited</span><span class="p">)</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">order</span><span class="o">.</span><span class="n">randomizeSize</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">randomizePrice</span><span class="p">])</span>


        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span> <span class="o">==</span> <span class="s2">&quot;PEG BENCH&quot;</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">order</span><span class="o">.</span><span class="n">reference_contract_id</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">is_pegged_change_amount_decrease</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">pegged_change_amount</span><span class="p">,</span>
                           <span class="n">order</span><span class="o">.</span><span class="n">reference_change_amount</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">reference_exchange_id</span><span class="p">])</span>

            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">conditions</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">conditions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">conditions</span><span class="p">:</span>
                    <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">type</span><span class="p">())</span>
                    <span class="c1"># TODO: make sure I ported logic in whatever happens 1 line below</span>
                    <span class="c1"># fields += cond.self.conn.make_message()</span>

                <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">order</span><span class="o">.</span><span class="n">conditionsIgnoreRth</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">conditionsCancelOrder</span><span class="p">])</span>

            <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">order</span><span class="o">.</span><span class="n">adjusted_order_type</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">trigger_price</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">limit_price_offset</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">adjusted_stop_price</span><span class="p">,</span>
                           <span class="n">order</span><span class="o">.</span><span class="n">adjusted_trailing_amount</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">adjusted_trailing_unit</span><span class="p">])</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">extOperator</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">order</span><span class="o">.</span><span class="n">softDollarTier</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">order</span><span class="o">.</span><span class="n">softDollarTier</span><span class="o">.</span><span class="n">val</span><span class="p">])</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">cash_qty</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">mifid2DecisionMaker</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">mifid2DecisionAlgo</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">mifid2ExecutionTrader</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">mifid2ExecutionAlgo</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">dontUseAutoPriceForHedge</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">isOmsContainer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.replace_financial_advisor"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.replace_financial_advisor">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">replace_financial_advisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">financial_advisor_data</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cxml</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to modify FA configuration information from the</span>
<span class="sd">        API. Note that this can also be done manually in TWS itself.</span>

<span class="sd">        financial_advisor_data:int - Specifies the type of Financial Advisor</span>
<span class="sd">            configuration data beingingg requested. Valid values include:</span>
<span class="sd">            1 = GROUPS</span>
<span class="sd">            2 = PROFILE</span>
<span class="sd">            3 = ACCOUNT ALIASES</span>
<span class="sd">        cxml: str - The XML string containing the new FA configuration</span>
<span class="sd">            information.  &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;replace_fa&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">financial_advisor_data</span><span class="p">,</span> <span class="n">cxml</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_account_updates"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_account_updates">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_account_updates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subscribe</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">account_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to start getting account values, portfolio,</span>


<span class="sd">        subscribe:bool - If set to TRUE, the client will start receiving account</span>
<span class="sd">            and Portfolio updates. If set to FALSE, the client will stop</span>
<span class="sd">            receiving this information.</span>
<span class="sd">        account_code:str -The account code for which to receive account and</span>
<span class="sd">            portfolio updates.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_acct_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">subscribe</span><span class="p">,</span> <span class="n">account_code</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.request_account_updates_multi"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_account_updates_multi">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_account_updates_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                      <span class="n">ledgerAndNLV</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Requests account updates for account and/or model.&quot;&quot;&quot;</span>

        <span class="n">message_version</span>         <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span>              <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_account_updates_multi&#39;</span><span class="p">]</span>
        <span class="n">fields</span>                  <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">model_code</span><span class="p">,</span> <span class="n">ledgerAndNLV</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_account_summary"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_account_summary">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_account_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">group_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this method to request and keep up to date the data that appears</span>
<span class="sd">        on the TWS Account Window Summary tab. The data is returned by</span>
<span class="sd">        accountSummary().</span>

<span class="sd">        Note:   This request is designed for an FA managed account but can be</span>
<span class="sd">        used for any multi-account structure.</span>

<span class="sd">        request_id:int - The ID of the data request. Ensures that responses are matched</span>
<span class="sd">            to requests If several requests are in process.</span>
<span class="sd">        group_name:str - Set to All to returnrn account summary data for all</span>
<span class="sd">            accounts, or set to a specific Advisor Account Group name that has</span>
<span class="sd">            already been created in TWS Global Configuration.</span>
<span class="sd">        tags:str - A comma-separated list of account tags.  Available tags are:</span>
<span class="sd">            accountountType</span>
<span class="sd">            NetLiquidation,</span>
<span class="sd">            TotalCashValue - Total cash including futures pnl</span>
<span class="sd">            SettledCash - For cash accounts, this is the same as</span>
<span class="sd">            TotalCashValue</span>
<span class="sd">            AccruedCash - Net accrued interest</span>
<span class="sd">            BuyingPower - The maximum amount of marginable US stocks the</span>
<span class="sd">                account can buy</span>
<span class="sd">            EquityWithLoanValue - Cash + stocks + bonds + mutual funds</span>
<span class="sd">            PreviousDayEquityWithLoanValue,</span>
<span class="sd">            GrossPositionValue - The sum of the absolute value of all stock</span>
<span class="sd">                and equity option positions</span>
<span class="sd">            RegTEquity,</span>
<span class="sd">            RegTMargin,</span>
<span class="sd">            SMA - Special Memorandum Account</span>
<span class="sd">            InitMarginReq,</span>
<span class="sd">            MaintMarginReq,</span>
<span class="sd">            AvailableFunds,</span>
<span class="sd">            ExcessLiquidity,</span>
<span class="sd">            Cushion - Excess liquidity as a percentage of net liquidation value</span>
<span class="sd">            FullInitMarginReq,</span>
<span class="sd">            FullMaintMarginReq,</span>
<span class="sd">            FullAvailableFunds,</span>
<span class="sd">            FullExcessLiquidity,</span>
<span class="sd">            LookAheadNextChange - Time when look-ahead values take effect</span>
<span class="sd">            LookAheadInitMarginReq,</span>
<span class="sd">            LookAheadMaintMarginReq,</span>
<span class="sd">            LookAheadAvailableFunds,</span>
<span class="sd">            LookAheadExcessLiquidity,</span>
<span class="sd">            HighestSeverity - A measure of how close the account is to liquidation</span>
<span class="sd">            DayTradesRemaining - The Number of Open/Close trades a user</span>
<span class="sd">                could put on before Pattern Day Trading is detected. A value of &quot;-1&quot;</span>
<span class="sd">                means that the user can put on unlimited day trades.</span>
<span class="sd">            Leverage - GrossPositionValue / NetLiquidation</span>
<span class="sd">            $LEDGER - Single flag to relay all cash balance tags*, only in base</span>
<span class="sd">                currency.</span>
<span class="sd">            $LEDGER:CURRENCY - Single flag to relay all cash balance tags*, only in</span>
<span class="sd">                the specified currency.</span>
<span class="sd">            $LEDGER:ALL - Single flag to relay all cash balance tags* in all</span>
<span class="sd">            currencies.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_account_summary&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">group_name</span><span class="p">,</span> <span class="n">tags</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_all_open_orders"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_all_open_orders">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_all_open_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request the open orders placed from all</span>
<span class="sd">        clients and also from TWS. Each open order will be fed back through the</span>
<span class="sd">        openOrder() and orderStatus() functions on the EWrapper.</span>

<span class="sd">        Note:  No association is made between the returned orders and the</span>
<span class="sd">        requesting client.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_all_open_orders&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_auto_open_orders"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_auto_open_orders">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_auto_open_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">auto_bind</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request that newly created TWS orders</span>
<span class="sd">        be implicitly associated with the client. When a new TWS order is</span>
<span class="sd">        created, the order will be associated with the client, and fed back</span>
<span class="sd">        through the openOrder() and orderStatus() functions on the EWrapper.</span>

<span class="sd">        Note:  This request can only be made from a client with client_id of 0.</span>

<span class="sd">        auto_bind: If set to TRUE, newly created TWS orders will be implicitly</span>
<span class="sd">        associated with the client. If set to FALSE, no association will be</span>
<span class="sd">        made.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_auto_open_orders&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">auto_bind</span><span class="p">]</span>
        <span class="n">message_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message_sent</span></div>

<div class="viewcode-block" id="ApiCalls.request_contract_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_contract_data">[docs]</a>    <span class="k">def</span> <span class="nf">request_contract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">request_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to download all details for a particular</span>
<span class="sd">        underlying. The contract details will be received via the contractDetails()</span>
<span class="sd">        function on the EWrapper.</span>

<span class="sd">        request_id:int - The ID of the data request. Ensures that responses are</span>
<span class="sd">            make_fieldatched to requests if several requests are in process.</span>
<span class="sd">        contract:Contract - The summary description of the contract being looked</span>
<span class="sd">            up.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">request_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
           <span class="n">request_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_request_id</span><span class="p">()</span>

        <span class="c1"># send req market data msg</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_contract_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span><span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span><span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span><span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span><span class="n">contract</span><span class="o">.</span><span class="n">include_expired</span><span class="p">,</span>  <span class="n">contract</span><span class="o">.</span><span class="n">security_id_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_id</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request_id</span></div>

<div class="viewcode-block" id="ApiCalls.request_current_time"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_current_time">[docs]</a>    <span class="k">def</span> <span class="nf">request_current_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Asks the current system time on the server side.</span>

<span class="sd">        Related Response Messages</span>
<span class="sd">        IN.CURRENT_TIME</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_current_time&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_executions"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_executions">[docs]</a>    <span class="k">def</span> <span class="nf">request_executions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">client_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">account_code</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                           <span class="n">symbol</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">security_type</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">exchange</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;When this function is called, the execution reports that meet the</span>
<span class="sd">        filter criteria are downloaded to the client via the execDetails()</span>
<span class="sd">        function. To view executions beyond the past 24 hours, open the</span>
<span class="sd">        Trade Log in TWS and, while the Trade Log is displayed, request</span>
<span class="sd">        the executions again from the API.</span>

<span class="sd">        request_id:int - The ID of the data request. Ensures that responses are</span>
<span class="sd">            matched to requests if several requests are in process.</span>
<span class="sd">        execFilter:ExecutionFilter - This object contains attributes that</span>
<span class="sd">            describe the filter criteria used to determine which execution</span>
<span class="sd">            reports are returned.</span>

<span class="sd">        NOTE: Time format must be &#39;yyyymmdd-hh:mm:ss&#39; Eg: &#39;20030702-14:55&#39;&quot;&quot;&quot;</span>

        <span class="c1"># Create and Send the Message</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_executions&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">client_id</span><span class="p">,</span> <span class="n">account_code</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span>
                   <span class="n">symbol</span><span class="p">,</span> <span class="n">security_type</span><span class="p">,</span> <span class="n">exchange</span><span class="p">,</span> <span class="n">side</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_global_cancel"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_global_cancel">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_global_cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use this function to cancel all open orders globally. It</span>
<span class="sd">        cancels both API and TWS open orders.</span>

<span class="sd">        If the order was created in TWS, it also gets canceled. If the order</span>
<span class="sd">        was initiated in the API, it also gets canceled.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_global_cancel&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

    <span class="c1"># Note that formatData parameter affects intraday bars only</span>
    <span class="c1"># 1-day bars always return with date in YYYYMMDD format</span>
<div class="viewcode-block" id="ApiCalls.request_head_time_stamp"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_head_time_stamp">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_head_time_stamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span>
                                <span class="n">whatToShow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">useRTH</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">formatDate</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_head_timestamp&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">include_expired</span><span class="p">,</span> <span class="n">useRTH</span><span class="p">,</span> <span class="n">whatToShow</span><span class="p">,</span> <span class="n">formatDate</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_historical_news"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_historical_news">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_historical_news</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">conId</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">providerCodes</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">startDateTime</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">totalResults</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">historicalNewsOptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_historical_news&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">conId</span><span class="p">,</span> <span class="n">providerCodes</span><span class="p">,</span> <span class="n">startDateTime</span><span class="p">,</span> <span class="n">end_date_time</span><span class="p">,</span> <span class="n">totalResults</span><span class="p">]</span>

        <span class="c1"># send historicalNewsOptions parameter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_NEWS_QUERY_ORIGINS</span><span class="p">:</span>
            <span class="n">func_options</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">historicalNewsOptions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tagValue</span> <span class="ow">in</span> <span class="n">historicalNewsOptions</span><span class="p">:</span>
                    <span class="n">func_options</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValue</span><span class="p">)</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">appened</span><span class="p">(</span><span class="n">func_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_historical_ticks"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_historical_ticks">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_historical_ticks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">startDateTime</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">end_date_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">number_of_ticks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">whatToShow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">useRth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                 <span class="n">ignoreSize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">miscOptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>

        <span class="n">miscOptionsString</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">miscOptions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tagValue</span> <span class="ow">in</span> <span class="n">miscOptions</span><span class="p">:</span>
                <span class="n">miscOptionsString</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValue</span><span class="p">)</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_historical_ticks&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">include_expired</span><span class="p">,</span> <span class="n">startDateTime</span><span class="p">,</span> <span class="n">end_date_time</span><span class="p">,</span> <span class="n">number_of_ticks</span><span class="p">,</span> <span class="n">whatToShow</span><span class="p">,</span> <span class="n">useRth</span><span class="p">,</span>
                  <span class="n">ignoreSize</span><span class="p">,</span> <span class="n">miscOptionsString</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_managed_accounts"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_managed_accounts">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_managed_accounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request the list of managed accounts. The list</span>
<span class="sd">        will be returned by the managedAccounts() function on the EWrapper.</span>

<span class="sd">        Note:  This request can only be made when connected to a FA managed account.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_managed_accounts&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_market_data_type"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_market_data_type">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_market_data_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market_data_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The API can receive frozen market data from Trader</span>
<span class="sd">        Workstation. Frozen market data is the last data recorded in our system.</span>
<span class="sd">        During normal trading hours, the API receives real-time market data. If</span>
<span class="sd">        you use this function, you are telling TWS to automatically switch to</span>
<span class="sd">        frozen market data after the close. Then, before the opening of the next</span>
<span class="sd">        trading day, market data will automatically switch back to real-time</span>
<span class="sd">        market data.</span>

<span class="sd">        market_data_type:int - 1 for real-time streaming market data or 2 for</span>
<span class="sd">            frozen market data&quot;&quot;&quot;</span>

        <span class="c1"># Create and send the message</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_market_data_type&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">market_data_type</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_market_depth_exchanges"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_market_depth_exchanges">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_market_depth_exchanges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_market_depth&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_market_rule"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_market_rule">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_market_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market_rule_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request Market Rule Information</span>

<span class="sd">        :param market_rule_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_market_rule&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_news_providers"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_news_providers">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_news_providers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request a list of news providers.</span>

<span class="sd">        :return: True/False - True if message was sent, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_news_providers&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">]</span>
        <span class="n">message_sent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message_sent</span></div>

<div class="viewcode-block" id="ApiCalls.request_open_orders"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_open_orders">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_open_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request the open orders that were</span>
<span class="sd">        placed from this client. Each open order will be fed back through the</span>
<span class="sd">        openOrder() and orderStatus() functions on the EWrapper.</span>

<span class="sd">        Note:  The client with a client_id of 0 will also receive the TWS-owned</span>
<span class="sd">        open orders. These orders will be associated with the client and a new</span>
<span class="sd">        order_id will be generated. This association will persist over multiple</span>
<span class="sd">        API and TWS sessions.  &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_open_orders&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_positions"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_positions">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Requests real-time position data for all accounts.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_positions&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_positions_multi"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_positions_multi">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_positions_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requests positions for account and/or model.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_positions_multi&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">model_code</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_smart_components"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_smart_components">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_smart_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bboExchange</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">message_id</span>  <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_smart_components&#39;</span><span class="p">]</span>
        <span class="n">fields</span>      <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">bboExchange</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.set_server_log_level"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.set_server_log_level">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">set_server_log_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The default detail level is ERROR. For more details, see API</span>
<span class="sd">        Logging.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;set_server_log_level&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">logLevel</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.start_api"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.start_api">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">start_api</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  Initiates the message exchange between the client application and</span>
<span class="sd">        the TWS/IB Gateway. &quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;start_api&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">optional_capabilities</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.subscribe_to_group_events"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.subscribe_to_group_events">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">subscribe_to_group_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">groupId</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;request_id:int - The unique number associated with the notification.</span>
<span class="sd">        groupId:int - The ID of the group, currently it is a number from 1 to 7.</span>
<span class="sd">            This is the display group subscription request sent by the API to TWS.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;subscribe_to_group_events&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">groupId</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.connect"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">client_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function must be called before any other. There is no</span>
<span class="sd">        feedback for a successful connection, but a subsequent attempt to</span>
<span class="sd">        connect will return the message \&quot;Already connected.\&quot;</span>

<span class="sd">        host:str - The host name or IP address of the machine where TWS is</span>
<span class="sd">            running. Leave blank to connect to the local host.</span>
<span class="sd">        port:int - Must match the port specified in TWS on the</span>
<span class="sd">            Configure&gt;API&gt;Socket Port field.</span>
<span class="sd">        client_id:int - A number used to identify this client connection. All</span>
<span class="sd">            orders placed/modified from this client will be associated with</span>
<span class="sd">            this client identifier.</span>

<span class="sd">            Note: Each client MUST connect with a unique client_id.&quot;&quot;&quot;</span>

        <span class="c1"># Establish connection to the bridge (TWS/IBGW)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_state</span> <span class="o">=</span> <span class="s2">&quot;Establishing Connection to the Bridge Application(TWS/IB Gateway)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span> <span class="o">=</span> <span class="n">client_id</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connecting to </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2"> w/ id:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">BridgeConnection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

            <span class="c1"># Send a message to connect to the Bridge (No response is given)</span>
            <span class="n">v100prefix</span> <span class="o">=</span> <span class="s2">&quot;API</span><span class="se">\0</span><span class="s2">&quot;</span>
            <span class="n">v100version</span> <span class="o">=</span> <span class="s2">&quot;v</span><span class="si">%d</span><span class="s2">..</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MIN_CLIENT_VER</span><span class="p">,</span> <span class="n">MAX_CLIENT_VER</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_msg</span><span class="p">(</span><span class="n">v100version</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">v100prefix</span><span class="p">,</span> <span class="s1">&#39;ascii&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">msg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">receive_messages</span><span class="p">(</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">(</span><span class="n">server_version</span><span class="p">,</span> <span class="n">conn_time</span><span class="p">)</span> <span class="o">=</span> <span class="n">message</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">connection_time</span> <span class="o">=</span> <span class="n">conn_time</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connection Time: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_time</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">server_version_</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">server_version</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server Version: </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version_</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">start_api</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Connected to </span><span class="si">%s</span><span class="s2">:</span><span class="si">%d</span><span class="s2"> w/ id:</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_id</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">api_state</span>  <span class="o">=</span> <span class="s2">&quot;Disconnected from the Bridge Application(TWS/IB Gateway).&quot;</span></div>

<div class="viewcode-block" id="ApiCalls.request_historical_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_historical_data">[docs]</a>    <span class="k">def</span> <span class="nf">request_historical_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">end_date_time</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">duration</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bar_size_setting</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">what_to_show</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">use_rth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">format_date</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">keep_up_to_date</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">chart_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Requests contracts&#39; historical data. When requesting historical data, a</span>
<span class="sd">        finishing time and date is required along with a duration string. The</span>
<span class="sd">        resulting bars will be returned in EWrapper.historicalData()</span>

<span class="sd">        request_id:int - The id of the request. Must be a unique value. When the</span>
<span class="sd">            market data returns, it whatToShowill be identified by this tag. This is also</span>
<span class="sd">            used when canceling the market data.</span>
<span class="sd">        contract:Contract - This object contains a description of the contract for which</span>
<span class="sd">            market data is being requested.</span>
<span class="sd">        end_date_time:str - Defines a query end date and time at any point during the past 6 mos.</span>
<span class="sd">            Valid values include any date/time within the past six months in the format:</span>
<span class="sd">            yyyymmdd HH:mm:ss ttt</span>

<span class="sd">            where &quot;ttt&quot; is the optional time zone.</span>
<span class="sd">        durationStr:str - Set the query duration up to one week, using a time unit</span>
<span class="sd">            of seconds, days or weeks. Valid values include any integer followed by a space</span>
<span class="sd">            and then S (seconds), D (days) or W (week). If no unit is specified, seconds is used.</span>
<span class="sd">        barSizeSetting:str - Specifies the size of the bars that will be returned (within IB/TWS listimits).</span>
<span class="sd">            Valid values include:</span>
<span class="sd">            1 sec</span>
<span class="sd">            5 secs</span>
<span class="sd">            15 secs</span>
<span class="sd">            30 secs</span>
<span class="sd">            1 min</span>
<span class="sd">            2 mins</span>
<span class="sd">            3 mins</span>
<span class="sd">            5 mins</span>
<span class="sd">            15 mins</span>
<span class="sd">            30 mins</span>
<span class="sd">            1 hour</span>
<span class="sd">            1 day</span>
<span class="sd">        whatToShow:str - Determines the nature of data beinging extracted. Valid values include:</span>

<span class="sd">            TRADES</span>
<span class="sd">            MIDPOINT</span>
<span class="sd">            BID</span>
<span class="sd">            ASK</span>
<span class="sd">            BID_ASK</span>
<span class="sd">            HISTORICAL_VOLATILITY</span>
<span class="sd">            OPTION_IMPLIED_VOLATILITY</span>
<span class="sd">        useRTH:int - Determines whether to return all data available during the requested time span,</span>
<span class="sd">            or only data that falls within regular trading hours. Valid values include:</span>

<span class="sd">            0 - all data is returned even where the market in question was outside of its</span>
<span class="sd">            regular trading hours.</span>
<span class="sd">            1 - only data within the regular trading hours is returned, even if the</span>
<span class="sd">            requested time span falls partially or completely outside of the RTH.</span>
<span class="sd">        formatDate: int - Determines the date format applied to returned bars. validd values include:</span>

<span class="sd">            1 - dates applying to bars returned in the format: yyyymmdd{space}{space}hh:mm:dd</span>
<span class="sd">            2 - dates are returned as a long integer specifying the number of seconds since</span>
<span class="sd">                1/1/1970 GMT.</span>
<span class="sd">        chartOptions:list - For internal use only. Use default value XYZ. &quot;&quot;&quot;</span>

        <span class="c1"># Get the request id for this work</span>
        <span class="c1">#request_id = self.conn.generate_request_id()</span>

        <span class="c1"># Create Message</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="mi">29</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_historical_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">include_expired</span><span class="p">,</span><span class="n">end_date_time</span><span class="p">,</span> <span class="n">bar_size_setting</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">use_rth</span><span class="p">,</span> <span class="n">what_to_show</span><span class="p">,</span> <span class="n">format_date</span><span class="p">]</span>


       <span class="c1"># Send combo legs for BAG requests</span>
        <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span> <span class="o">==</span> <span class="s2">&quot;BAG&quot;</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">comboLeg</span> <span class="ow">in</span> <span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">contract_id</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">exchange</span><span class="p">)</span>


        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">keep_up_to_date</span><span class="p">)</span>
        <span class="c1"># send chartOptions parameter</span>
        <span class="n">chart_options_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">chart_options</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tagValue</span> <span class="ow">in</span> <span class="n">chart_options</span><span class="p">:</span>
                <span class="n">chart_options_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValue</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chart_options_str</span><span class="p">)</span>

        <span class="c1"># Send the Message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.request_news_bulletins"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_news_bulletins">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_news_bulletins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_messages</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request to receive news bulletins.</span>

<span class="sd">        :param all_messages: If set to TRUE, returns all the existing bulletins for the current day</span>
<span class="sd">                             If set to FALSE, will only return new bulletins.</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span>      <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_news_bulletins&#39;</span><span class="p">]</span>
        <span class="n">fields</span>          <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">all_messages</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_pnl"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_pnl">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_pnl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">message_id</span>  <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_pnl&#39;</span><span class="p">]</span>
        <span class="n">fields</span>      <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">model_code</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_pnl_single"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_pnl_single">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_pnl_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">account</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">contract_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_pnl_single&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">account</span><span class="p">,</span> <span class="n">model_code</span><span class="p">,</span> <span class="n">contract_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_tick_by_tick_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_tick_by_tick_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_tick_by_tick_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">tick_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                  <span class="n">number_of_ticks</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ignoreSize</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_tick_by_tick_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span> <span class="n">tick_type</span>
                  <span class="p">]</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number_of_ticks</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ignoreSize</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.server_version"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.server_version">[docs]</a>    <span class="k">def</span> <span class="nf">server_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the version of the TWS instance to which the API</span>
<span class="sd">        application is connected.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_</span></div>

<div class="viewcode-block" id="ApiCalls.verify_request"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.verify_request">[docs]</a>    <span class="k">def</span> <span class="nf">verify_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apiName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Allows for an application to request what the correct message should be for a given api/version.</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1">#if not self.extra_auth:</span>
        <span class="c1">#    self.response_handler.error(NO_VALID_ID, BAD_MESSAGE.code(), BAD_MESSAGE.msg() +</span>
        <span class="c1">#                                &quot;  Intent to authenticate needs to be expressed during initial connect request.&quot;)</span>
        <span class="c1">#    return</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;verify_request&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">apiName</span><span class="p">,</span> <span class="n">api_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_market_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_market_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_market_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">generic_tick_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                            <span class="n">snapshot</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">regulatory_snapshot</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">market_data_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request market data. The market data</span>
<span class="sd">                will be returned by the tickPrice and tickSize events.</span>

<span class="sd">                request_id: int - The ticker id. Must be a unique value. When the</span>
<span class="sd">                    market data returns, it will be identified by this tag. This is</span>
<span class="sd">                    also used when canceling the market data.</span>
<span class="sd">                contract:Contract - This structure contains a description of the</span>
<span class="sd">                    Contractt for which market data is being requested.</span>
<span class="sd">                genericTickList:str - A commma delimited list of generic tick types.</span>
<span class="sd">                    Tick types can be found in the Generic Tick Types page.</span>
<span class="sd">                    Prefixing w/ &#39;mdoff&#39; indicates that top market data shouldn&#39;t tick.</span>
<span class="sd">                    You can specify the news source by postfixing w/ &#39;:&lt;source&gt;.</span>
<span class="sd">                    Example: &quot;mdoff,292:FLY+BRF&quot;</span>
<span class="sd">                snapshot:bool - Check to return a single snapshot of Market data and</span>
<span class="sd">                    have the market data subscription cancel. Do not enter any</span>
<span class="sd">                    genericTicklist values if you use snapshots.</span>
<span class="sd">                regulatorySnapshot: bool - With the US Value Snapshot Bundle for stocks,</span>
<span class="sd">                    regulatory snapshots are available for 0.01 USD each.</span>
<span class="sd">                mktDataOptions:list - For internal use only.</span>
<span class="sd">                    Use default value XYZ. &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">11</span>

        <span class="c1"># send req market data msg</span>
        <span class="n">insert_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_market_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                          <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span>
                          <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                          <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span>
                          <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">]</span>

        <span class="c1"># Send Contract Fields</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_REQ_MKT_DATA_CONID</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="n">insert_offset</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_TRADING_CLASS</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">)</span>
            <span class="n">insert_offset</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Send combo legs for BAG requests (srv v8 and above)</span>
        <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span> <span class="o">==</span> <span class="s2">&quot;BAG&quot;</span><span class="p">:</span>
            <span class="n">combo_leg_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span><span class="p">)</span> <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combo_leg_count</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">comboLeg</span> <span class="ow">in</span> <span class="n">contract</span><span class="o">.</span><span class="n">combo_legs</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">conId</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">ratio</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comboLeg</span><span class="o">.</span><span class="n">exchange</span><span class="p">)</span>

        <span class="c1"># Send Delta Neutral Contract Fields</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_DELTA_NEUTRAL</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="o">.</span><span class="n">conId</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="o">.</span><span class="n">delta</span><span class="p">)</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">delta_neutral_contract</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generic_tick_list</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snapshot</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_REQ_SMART_COMPONENTS</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regulatory_snapshot</span><span class="p">)</span>

        <span class="c1"># send mktDataOptions parameter</span>
        <span class="c1"># TODO: Clarify if the code is beneficial</span>
        <span class="c1"># if self.server_version() &gt;= MIN_SERVER_VER_LINKING:</span>
        <span class="c1">#    # current doc says this part if for &quot;internal use only&quot; -&gt; won&#39;t support it</span>
        <span class="c1">#    if mktDataOptions:</span>
        <span class="c1">#        raise NotImplementedError(&quot;not supported&quot;)</span>
        <span class="c1">#    mktDataOptionsStr = &quot;&quot;</span>
        <span class="c1">#    fields += [mktDataOptionsStr), ]</span>

        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.tws_connection_time"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.tws_connection_time">[docs]</a>    <span class="k">def</span> <span class="nf">tws_connection_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the time the API application made a connection to TWS.&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_time</span></div>

<div class="viewcode-block" id="ApiCalls.request_ids"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_ids">[docs]</a>    <span class="k">def</span> <span class="nf">request_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_ids</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request from TWS the next valid ID that</span>
<span class="sd">        can be used when placing an order.  After calling this function, the</span>
<span class="sd">        nextValidId() event will be triggered, and the id returned is that next</span>
<span class="sd">        valid ID. That ID will reflect any autobinding that has occurred (which</span>
<span class="sd">        generates new IDs and increments the next valid ID therein).</span>

<span class="sd">        num_ids:int - deprecated&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">NO_VALID_ID</span><span class="p">,</span> <span class="n">NOT_CONNECTED</span><span class="o">.</span><span class="n">code</span><span class="p">(),</span> <span class="n">NOT_CONNECTED</span><span class="o">.</span><span class="n">msg</span><span class="p">())</span>
            <span class="k">return</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_ids&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">num_ids</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_market_depth"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_market_depth">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_market_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                             <span class="n">request_id</span>             <span class="p">:</span> <span class="nb">int</span>       <span class="p">,</span>
                             <span class="n">contract</span>               <span class="p">:</span> <span class="n">Contract</span>  <span class="p">,</span>
                             <span class="n">num_rows</span>               <span class="p">:</span> <span class="nb">int</span>       <span class="p">,</span>
                             <span class="n">is_smart_depth</span>         <span class="p">:</span> <span class="nb">bool</span>      <span class="p">,</span>
                             <span class="n">market_depth_options</span>   <span class="p">:</span> <span class="nb">list</span>
                             <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to request market depth for a specific</span>
<span class="sd">        contract. The market depth will be returned by the updateMktDepth() and</span>
<span class="sd">        updateMktDepthL2() events.</span>

<span class="sd">        Requests the contract&#39;s market depth (order book). Note this request must be</span>
<span class="sd">        direct-routed to an exchange and not smart-routed. The number of simultaneous</span>
<span class="sd">        market depth requests allowed in an account is calculated based on a formula</span>
<span class="sd">        that looks at an accounts equity, commissions, and quote booster packs.</span>

<span class="sd">        request_id:int - The ticker id. Must be a unique value. When the market</span>
<span class="sd">            depth data returns, it will be identified by this tag. This is</span>
<span class="sd">            also used when canceling the market depth</span>
<span class="sd">        contract:Contact - This structure contains a description of the contract</span>
<span class="sd">            for which market depth data is being requested.</span>
<span class="sd">        num_rows:int - Specifies the numRowsumber of market depth rows to display.</span>
<span class="sd">        is_smart_depth:bool - specifies SMART depth request</span>
<span class="sd">        market_depth_options:list - For internal use only. Use default value</span>
<span class="sd">            XYZ.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_market_depth&#39;</span><span class="p">]</span>
        <span class="c1"># send req market depth msg</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span>  <span class="n">message_id</span>                                  <span class="p">,</span>   <span class="n">message_version</span>         <span class="p">,</span>
                    <span class="n">request_id</span>                                  <span class="p">,</span>   <span class="n">contract</span><span class="o">.</span><span class="n">id</span>             <span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span>                             <span class="p">,</span>   <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span>  <span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span>  <span class="p">,</span>   <span class="n">contract</span><span class="o">.</span><span class="n">strike</span>         <span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">right</span>                              <span class="p">,</span>   <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span>     <span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span>                           <span class="p">,</span>   <span class="n">contract</span><span class="o">.</span><span class="n">currency</span>       <span class="p">,</span>
                    <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span>                       <span class="p">,</span>   <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span>  <span class="p">,</span>
                    <span class="n">num_rows</span>                                    <span class="p">,</span>   <span class="n">is_smart_depth</span>          <span class="p">,</span>
                <span class="p">]</span>

        <span class="c1"># send market_depth_options parameter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_LINKING</span><span class="p">:</span>
            <span class="c1"># current doc says this part if for &quot;internal use only&quot; -&gt; won&#39;t support it</span>
            <span class="k">if</span> <span class="n">market_depth_options</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;not supported&quot;</span><span class="p">)</span>
            <span class="n">mktDataOptionsStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">mktDataOptionsStr</span><span class="p">,</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_news_bulletins"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_news_bulletins">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_news_bulletins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this function to stop receiving news bulletins.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_news_bulletins&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_financial_advisor"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_financial_advisor">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_financial_advisor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">financial_advisor_data</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requests Financial Advisor Configuration Information.</span>
<span class="sd">        The data returns in an XML string via a &quot;receiveFA&quot; ActiveX event.</span>

<span class="sd">        financial_advisor_data:int - Specifies the type of Financial Advisor</span>
<span class="sd">        Valid values include:</span>
<span class="sd">            1 = GROUPS</span>
<span class="sd">            2 = PROFILE</span>
<span class="sd">            3 = ACCOUNT ALIASES</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#Create the Message</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span>      <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_fa&#39;</span><span class="p">]</span>
        <span class="n">fields</span>          <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">financial_advisor_data</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_historical_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_historical_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_historical_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used if an internet disconnect has occurred or the results of a query</span>
<span class="sd">        are otherwise delayed and the application is no longer interested in receiving</span>
<span class="sd">        the data.</span>

<span class="sd">        request_id:int - The ticker ID. Must be a unique value.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_historical_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_head_time_stamp"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_head_time_stamp">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_head_time_stamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param request_id:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_head_timestamp&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_histogram_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_histogram_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_histogram_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span>
                               <span class="n">useRTH</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_histogram_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">ticker_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">include_expired</span><span class="p">,</span> <span class="n">useRTH</span><span class="p">,</span>
                  <span class="n">time_period</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.cancel_histogram_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.cancel_histogram_data">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">cancel_histogram_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;cancel_histogram_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_scanner_parameters"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_scanner_parameters">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_scanner_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Requests an XML string that describes all possible scanner queries.&quot;&quot;&quot;</span>

        <span class="c1">#if not self.conn.is_connected():</span>
        <span class="c1">#    self.response_handler.error(NO_VALID_ID, NOT_CONNECTED.code(), NOT_CONNECTED.msg())</span>
        <span class="c1">#    return</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_scanner_parameters&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.request_scanner_subscription"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_scanner_subscription">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_scanner_subscription</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">request_id</span>       <span class="p">:</span> <span class="nb">int</span>           <span class="p">,</span>
                                     <span class="n">scanner</span>          <span class="p">:</span> <span class="n">Scanner</span>       <span class="p">,</span>
                                     <span class="n">scanner_options</span>  <span class="p">:</span> <span class="nb">list</span>          <span class="p">,</span>
                                     <span class="n">filter_options</span>   <span class="p">:</span> <span class="nb">list</span>
                                     <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;request_id:int - Identifier for the given request</span>
<span class="sd">        scannerSubscription:Scanner - This structure contains</span>
<span class="sd">            possible parameters used to filter results.</span>
<span class="sd">        scanner_subscription_options:list - For internal use only.</span>
<span class="sd">            Use default value XYZ.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_scanner_subscription&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">]</span>

        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">request_id</span><span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">numberOfRows</span>                 <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">instrument</span>                   <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">location_code</span>                <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">scan_code</span>                    <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">above_price</span>                  <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">below_price</span>                  <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">above_volume</span>                 <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">market_cap_above</span>             <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">market_cap_below</span>             <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">moody_rating_above</span>           <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">moody_rating_below</span>           <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">sp_rating_above</span>              <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">sp_rating_below</span>              <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">maturity_date_above</span>          <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">maturity_date_below</span>          <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">coupon_rate_above</span>            <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">coupon_rate_below</span>            <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">exclude_convertible</span>          <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">average_option_volume_above</span>  <span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">scanner_setting_pairs</span><span class="p">,</span>
                   <span class="n">scanner</span><span class="o">.</span><span class="n">stock_type_filter</span><span class="p">]</span>

        <span class="c1"># send scannerSubscriptionFilterOptions parameter</span>
        <span class="n">filter_options_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filter_options</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tagValueOpt</span> <span class="ow">in</span> <span class="n">filter_options</span><span class="p">:</span>
                <span class="n">filter_options_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValueOpt</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">filter_options_str</span><span class="p">]</span>

        <span class="c1"># send scanner_scanner_options parameter</span>
        <span class="n">scanner_options_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">scanner_options</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tagValueOpt</span> <span class="ow">in</span> <span class="n">scanner_options</span><span class="p">:</span>
                <span class="n">scanner_options_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValueOpt</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">scanner_options_str</span><span class="p">,</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request__real_time_bars"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request__real_time_bars">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request__real_time_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span> <span class="n">barSize</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                <span class="n">whatToShow</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">useRTH</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                                <span class="n">realTimeBarsOptions</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the reqRealTimeBars() function to start receiving real time bar</span>
<span class="sd">        results through the realtimeBar() EWrapper function.</span>

<span class="sd">        request_id:int - The Id for the request. Must be a unique value. When the</span>
<span class="sd">            data is received, it will be identified by this Id. This is also</span>
<span class="sd">            used when canceling the request.</span>
<span class="sd">        contract:Contract - This object contains a description of the contract</span>
<span class="sd">            for which real time bars are being requested</span>
<span class="sd">        barSize:int - Currently only 5 second bars are supported, if any other</span>
<span class="sd">            value is used, an exception will be thrown.</span>
<span class="sd">        whatToShow:str - Determines the nature of the data extracted. Valid</span>
<span class="sd">            values include:</span>
<span class="sd">            TRADES</span>
<span class="sd">            BID</span>
<span class="sd">            ASK</span>
<span class="sd">            MIDPOINT</span>
<span class="sd">        useRTH:bool - Regular Trading Hours only. Valid values include:</span>
<span class="sd">            0 = all data available during the time span requested is returned,</span>
<span class="sd">                including time intervals when the market in question was</span>
<span class="sd">                outside of regular trading hours.</span>
<span class="sd">            1 = only data within the regular trading hours for the product</span>
<span class="sd">                requested is returned, even if the time time span falls</span>
<span class="sd">                partially or completely outside.</span>
<span class="sd">        realTimeBarOptions:list - For internal use only. Use default value XYZ.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_real_time_bars&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>

        <span class="c1"># send contract fields</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">last_trade_date_or_contract_month</span><span class="p">,</span>
                       <span class="n">contract</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span>
                       <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span>
                       <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">])</span>


        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">contract</span><span class="o">.</span><span class="n">trading_class</span><span class="p">,</span> <span class="p">]</span>

        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">barSize</span><span class="p">,</span> <span class="n">whatToShow</span><span class="p">,</span> <span class="n">useRTH</span><span class="p">]</span>

        <span class="c1"># send realTimeBarsOptions parameter</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">MIN_SERVER_VER_LINKING</span><span class="p">:</span>
            <span class="n">realTimeBarsOptionsStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="n">realTimeBarsOptions</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tagValueOpt</span> <span class="ow">in</span> <span class="n">realTimeBarsOptions</span><span class="p">:</span>
                    <span class="n">realTimeBarsOptionsStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValueOpt</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">realTimeBarsOptionsStr</span><span class="p">,</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ApiCalls.request_fundamental_data"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_fundamental_data">[docs]</a>    <span class="k">def</span> <span class="nf">request_fundamental_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract</span><span class="p">:</span> <span class="n">Contract</span><span class="p">,</span>
                                 <span class="n">report_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">request_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request Fundamental Data for a stock.</span>
<span class="sd">        The appropriate market data subscription must be set up in Account Management before you can receive this data.</span>
<span class="sd">        Contract.id can be specified in the Contract object but not trading_class or multiplier.</span>
<span class="sd">        This is because reqFundamentalData()   is used only for stocks and stocks do not have a multiplier and</span>
<span class="sd">        trading class.</span>

<span class="sd">        Response Messages</span>
<span class="sd">        IN.FUNDAMENTAL_DATA - The Requested Data</span>


<span class="sd">        reqFundamentalData() can handle contract_id specified in the Contract object,</span>
<span class="sd">        but not trading_class or multiplier. This is because reqFundamentalData()</span>
<span class="sd">        is used only for stocks and stocks do not have a multiplier and</span>
<span class="sd">        trading class.</span>

<span class="sd">        request_id:int - The ID of the data request. Ensures that responses are</span>
<span class="sd">             matched to requests if several requests are in process.</span>
<span class="sd">        contract:Contract - This structure contains a description of the</span>
<span class="sd">            contract for which fundamental data is being requested.</span>
<span class="sd">        report_type:str - One of the following XML reports:</span>
<span class="sd">            ReportSnapshot (company overview)</span>
<span class="sd">            ReportsFinSummary (financial summary)</span>
<span class="sd">            ReportRatios (financial ratios)</span>
<span class="sd">            ReportsFinStatements (financial statements)</span>
<span class="sd">            RESC (analyst estimates)</span>
<span class="sd">            CalendarReport (company calendar) &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Request #</span><span class="si">{0}</span><span class="s2"> - Calling request_fundamental_data&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request_id</span><span class="p">))</span>
        <span class="c1"># Create the message body</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_fundamental_data&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">security_type</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">primary_exchange</span><span class="p">,</span> <span class="n">contract</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                  <span class="n">contract</span><span class="o">.</span><span class="n">local_symbol</span><span class="p">,</span> <span class="n">report_type</span><span class="p">]</span>

        <span class="n">request_options_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">tag_values_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">request_options</span><span class="p">)</span> <span class="k">if</span> <span class="n">request_options</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">request_options</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fundDataOption</span> <span class="ow">in</span> <span class="n">request_options</span><span class="p">:</span>
                <span class="n">request_options_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fundDataOption</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">tag_values_count</span><span class="p">,</span> <span class="n">request_options_str</span><span class="p">])</span>

        <span class="c1"># Make the actual request</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_news_article"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_news_article">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_news_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">provider_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">articleId</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">news_article_options</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_news_article&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">+=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">provider_code</span><span class="p">,</span> <span class="n">articleId</span><span class="p">]</span>

        <span class="c1"># send news_article_options parameter</span>

        <span class="n">newsArticleOptionsStr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">news_article_options</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tagValue</span> <span class="ow">in</span> <span class="n">news_article_options</span><span class="p">:</span>
                <span class="n">newsArticleOptionsStr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tagValue</span><span class="p">)</span>

            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newsArticleOptionsStr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.query_display_groups"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.query_display_groups">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">query_display_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;API requests used to integrate with TWS color-grouped windows (display groups).</span>
<span class="sd">        TWS color-grouped windows are identified by an integer number. Currently that number ranges from 1 to 7 and are mapped to specific colors, as indicated in TWS.</span>

<span class="sd">        request_id:int - The unique number that will be associated with the</span>
<span class="sd">            response &quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;query_display_groups&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.update_display_group"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.update_display_group">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">update_display_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">contract_info</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;request_id:int - The requestId specified in subscribeToGroupEvents().</span>
<span class="sd">        contract_info:str - The encoded value that uniquely represents the</span>
<span class="sd">            contract in IB. Possible values include:</span>

<span class="sd">            none = empty selection</span>
<span class="sd">            contractID@exchange - any non-combination contract.</span>
<span class="sd">                Examples: 8314@SMART for IBM SMART; 8314@ARCA for IBM @ARCA.</span>
<span class="sd">            combo = if any combo is selected.&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;update_display_group&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">contract_info</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.unsubscribe_from_group_events"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.unsubscribe_from_group_events">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">unsubscribe_from_group_events</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;request_id:int - The requestId specified in subscribeToGroupEvents().&quot;&quot;&quot;</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;unsubscribe_from_group_events&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.verify_message"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.verify_message">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">verify_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For IB&#39;s internal purpose. Allows to provide means of verification</span>
<span class="sd">        between the TWS and third party programs.&quot;&quot;&quot;</span>
        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;verify_message&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">api_data</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.verify_and_auth_request"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.verify_and_auth_request">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">verify_and_auth_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                <span class="n">opaqueIsvKey</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For IB&#39;s internal purpose. Allows to provide means of verification</span>
<span class="sd">        between the TWS and third party programs.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">extra_auth</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_handler</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">NO_VALID_ID</span><span class="p">,</span> <span class="n">BAD_MESSAGE</span><span class="o">.</span><span class="n">code</span><span class="p">(),</span> <span class="n">BAD_MESSAGE</span><span class="o">.</span><span class="n">msg</span><span class="p">()</span> <span class="o">+</span>
                                        <span class="s2">&quot;  Intent to authenticate needs to be expressed during initial connect request.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">message_version</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;verify_and_auth_request&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">api_name</span><span class="p">,</span> <span class="n">api_version</span><span class="p">,</span> <span class="n">opaqueIsvKey</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.verify_and_auth_message"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.verify_and_auth_message">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">verify_and_auth_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">xyzResponse</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For IB&#39;s internal purpose. Allows to provide means of verification</span>
<span class="sd">        between the TWS and third party programs.&quot;&quot;&quot;</span>

        <span class="n">message_version</span>     <span class="o">=</span> <span class="mi">1</span>
        <span class="n">message_id</span>          <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;verify_and_auth_message&#39;</span><span class="p">]</span>
        <span class="n">fields</span>              <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">message_version</span><span class="p">,</span> <span class="n">api_data</span><span class="p">,</span> <span class="n">xyzResponse</span><span class="p">]</span>
        <span class="n">message</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_security_definition_option_parameters"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_security_definition_option_parameters">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_security_definition_option_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">underlying_symbol</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                      <span class="n">futFopExchange</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">underlyingSecType</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                                      <span class="n">underlying_contract_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Requests security definition option parameters for viewing a</span>
<span class="sd">        contract&#39;s option chain request_id the ID chosen for the request</span>
<span class="sd">        underlying_symbol futFopExchange The exchange on which the returned</span>
<span class="sd">        options are trading. Can be set to the empty string &quot;&quot; for all</span>
<span class="sd">        exchanges. underlyingSecType The type of the underlying security,</span>
<span class="sd">        i.e. STK underlying_contract_id the contract ID of the underlying security.</span>
<span class="sd">        Response comes via EWrapper.securityDefinitionOptionParameter()</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_security_definition_option_parameters&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">underlying_symbol</span><span class="p">,</span>
                  <span class="n">futFopExchange</span><span class="p">,</span> <span class="n">underlyingSecType</span><span class="p">,</span> <span class="n">underlying_contract_id</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_soft_dollar_tiers"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_soft_dollar_tiers">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_soft_dollar_tiers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Requests pre-defined Soft Dollar Tiers. This is only supported for</span>
<span class="sd">        registered professional advisors and hedge and mutual funds who have</span>
<span class="sd">        configured Soft Dollar Tiers in Account Management.&quot;&quot;&quot;</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_soft_dollar_tiers&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_family_codes"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_family_codes">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_family_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_family_codes&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="ApiCalls.request_matching_symbols"><a class="viewcode-back" href="../../../source/ibkr_api.base.html#ibkr_api.base.api_calls.ApiCalls.request_matching_symbols">[docs]</a>    <span class="nd">@check_connection</span>
    <span class="k">def</span> <span class="nf">request_matching_symbols</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param request_id:</span>
<span class="sd">        :param pattern:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create and send the Message</span>

        <span class="n">message_id</span> <span class="o">=</span> <span class="n">Messages</span><span class="o">.</span><span class="n">outbound</span><span class="p">[</span><span class="s1">&#39;request_matching_symbols&#39;</span><span class="p">]</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">message_id</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">pattern</span><span class="p">]</span>
        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">make_message</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">ibkr-api</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/architecture.html">IBKR_API Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/quick_start.html">Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/quick_start.html#request-handlers">Request Handlers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/faq.html">F.A.Q</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../samples/client_application.html">Client Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/modules.html">ibkr_api</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, David Orkin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>